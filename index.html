<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Loading Store...</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary: #00e0ff;
            --secondary: #0066ff;
            --dark-bg: #0f172a;
            --card-bg: #1e293b;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--dark-bg);
            color: #ffffff;
            margin: 0;
            overflow-x: hidden;
        }

        .glass {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .running-text-container {
            background: linear-gradient(90deg, var(--secondary), var(--primary));
            overflow: hidden;
            white-space: nowrap;
            height: 30px;
            display: flex;
            align-items: center;
        }

        .running-text {
            display: inline-block;
            padding-left: 100%;
            animation: marquee 20s linear infinite;
            font-size: 13px;
            font-weight: bold;
            color: white;
        }

        @keyframes marquee {
            0% { transform: translate(0, 0); }
            100% { transform: translate(-100%, 0); }
        }

        .category-card {
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .category-card:active { transform: scale(0.95); }

        .product-item {
            cursor: pointer;
            transition: 0.2s;
            border: 2px solid transparent;
        }

        .product-item.selected {
            border-color: var(--primary);
            background: rgba(0, 224, 255, 0.1);
        }

        .modal-bg {
            background: rgba(0, 0, 0, 0.85);
            display: none;
            position: fixed;
            inset: 0;
            z-index: 100;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .animate-zoom { animation: zoom 0.3s ease; }
        @keyframes zoom {
            from { opacity: 0; transform: scale(0.8); }
            to { opacity: 1; transform: scale(1); }
        }

        /* Hide Scrollbar */
        ::-webkit-scrollbar { width: 0px; background: transparent; }
    </style>
</head>
<body>

    <div id="loader" class="fixed inset-0 z-[999] bg-slate-900 flex flex-col items-center justify-center">
        <div class="w-12 h-12 border-4 border-cyan-400 border-t-transparent rounded-full animate-spin"></div>
    </div>

    <div class="running-text-container">
        <div class="running-text" id="runningText">Memuat informasi toko...</div>
    </div>

    <nav class="sticky top-0 z-50 glass px-4 py-3 flex justify-between items-center">
        <div class="flex items-center gap-3">
            <img src="" id="shopLogo" class="w-10 h-10 rounded-full object-cover shadow-lg border border-white/20" alt="Logo">
            <div>
                <h1 id="shopName" class="font-bold text-base leading-tight">...</h1>
                <p id="shopSlogan" class="text-[9px] text-cyan-400 uppercase tracking-widest font-semibold">...</p>
            </div>
        </div>
        <div class="text-right">
            <p class="text-[9px] text-gray-400">Jam Operasional</p>
            <p id="shopHours" class="text-[10px] font-bold text-green-400">...</p>
        </div>
    </nav>

    <main class="max-w-xl mx-auto p-4 mb-24">
        
        <div id="mainMenu" class="grid grid-cols-2 gap-3 mb-6">
            <div onclick="openCategory('ITEM GAME')" class="category-card glass rounded-2xl p-5 flex flex-col items-center gap-2">
                <div class="w-12 h-12 bg-cyan-500/20 rounded-full flex items-center justify-center">
                    <i class="fas fa-gamepad text-cyan-400 text-xl"></i>
                </div>
                <span class="text-xs font-bold">ITEM GAME</span>
            </div>
            <div onclick="openCategory('PULSA')" class="category-card glass rounded-2xl p-5 flex flex-col items-center gap-2">
                <div class="w-12 h-12 bg-green-500/20 rounded-full flex items-center justify-center">
                    <i class="fas fa-mobile-alt text-green-400 text-xl"></i>
                </div>
                <span class="text-xs font-bold">PULSA & KUOTA</span>
            </div>
            <div onclick="openCategory('VOUCHER')" class="category-card glass rounded-2xl p-5 flex flex-col items-center gap-2">
                <div class="w-12 h-12 bg-yellow-500/20 rounded-full flex items-center justify-center">
                    <i class="fas fa-ticket-alt text-yellow-400 text-xl"></i>
                </div>
                <span class="text-xs font-bold">VOUCHER</span>
            </div>
            <div onclick="openCategory('PREMIUM')" class="category-card glass rounded-2xl p-5 flex flex-col items-center gap-2">
                <div class="w-12 h-12 bg-purple-500/20 rounded-full flex items-center justify-center">
                    <i class="fas fa-crown text-purple-400 text-xl"></i>
                </div>
                <span class="text-xs font-bold">PREMIUM APP</span>
            </div>
        </div>

        <div id="subSection" class="hidden">
            <div class="flex items-center gap-2 mb-4" onclick="backToMain()">
                <i class="fas fa-chevron-left text-cyan-400"></i>
                <span class="font-bold text-sm">Kembali</span>
            </div>
            <h2 id="subTitle" class="text-lg font-bold mb-4">Pilih Game</h2>
            <div id="subGrid" class="grid grid-cols-3 gap-3"></div>
        </div>

        <div id="productSection" class="hidden">
            <div class="flex items-center gap-2 mb-4" onclick="backToSub()">
                <i class="fas fa-chevron-left text-cyan-400"></i>
                <span class="font-bold text-sm" id="btnBackText">Kembali</span>
            </div>
            
            <img id="detailBanner" class="w-full aspect-[16/9] object-cover rounded-2xl mb-6 shadow-xl" src="">

            <div class="glass rounded-2xl p-4 mb-6">
                <h3 class="text-sm font-bold mb-3"><i class="fas fa-id-card text-cyan-400 mr-2"></i>Data Akun / Nomor</h3>
                <input type="text" id="targetId" placeholder="Masukkan ID atau No HP..." class="w-full bg-slate-900/50 border border-white/10 p-3 rounded-xl text-sm focus:border-cyan-400 outline-none">
            </div>

            <h3 class="text-sm font-bold mb-3 px-1"><i class="fas fa-shopping-cart text-cyan-400 mr-2"></i>Pilih Nominal</h3>
            <div id="productGrid" class="grid grid-cols-2 gap-3"></div>
        </div>

    </main>

    <div id="orderBar" class="fixed bottom-0 inset-x-0 glass border-t border-white/10 p-4 hidden z-50">
        <div class="max-w-xl mx-auto flex justify-between items-center">
            <div>
                <p class="text-[10px] text-gray-400">Total Harga</p>
                <p id="totalPrice" class="text-lg font-bold text-cyan-400">Rp 0</p>
            </div>
            <button onclick="submitOrder()" class="bg-cyan-500 text-slate-900 font-extrabold px-6 py-3 rounded-xl shadow-lg shadow-cyan-500/30">BELI SEKARANG</button>
        </div>
    </div>

    <div id="modal" class="modal-bg">
        <div class="glass w-full max-w-xs p-6 rounded-3xl text-center animate-zoom">
            <div id="modalIcon" class="mb-4"></div>
            <h3 id="modalTitle" class="text-lg font-bold mb-2"></h3>
            <p id="modalDesc" class="text-sm text-gray-400 mb-6"></p>
            <button id="modalBtn" class="w-full bg-cyan-500 text-slate-900 font-bold py-3 rounded-xl"></button>
        </div>
    </div>

 <script>
    // --- KONFIGURASI ---
    // Ganti ID di bawah dengan ID dari URL Spreadsheet Anda
    const SPREADSHEET_ID = '1LcuDp-LXMSTe64jTZXc6CAgIoXhJXIVVpOzNRQDx4BY'; 
    const API_URL = `https://opensheet.elk.sh/${SPREADSHEET_ID}`;

    let db_setup = {};
    let db_products = [];
    let selectedProduct = null;
    let activeSub = "";

    // Mapping Data Statis sesuai permintaan Anda
    const categories = {
        'ITEM GAME': ['Mobile Legend', 'Free Fire', 'PUBG Mobile', 'COD Mobile', 'PB Zepetto', 'Arena Of Valor', 'Genshin Impact', 'Eggy Party Coins', 'Stumble Guys', 'Lita Coin'],
        'PULSA': ['Axis', 'Indosat', 'Smartfren', 'Telkomsel', 'Tri', 'XL', 'By.U'],
        'VOUCHER': ['Steam', 'Garena', 'PUBG Mobile (Vcr)', 'Roblox'],
        'PREMIUM': ['Canva', 'Spotify', 'Netflix', 'YouTube', 'Vidio', 'Alight Motion', 'Viu']
    };

async function init() {
        // Paksa hilangkan loader jika dalam 7 detik data tidak muncul
        const timeout = setTimeout(() => {
            const loader = document.getElementById('loader');
            if (loader && loader.style.display !== 'none') {
                loader.style.display = 'none';
                alert("Koneksi lambat atau Spreadsheet belum di-Publish ke Web!");
            }
        }, 7000);

        try {
            console.log("Menghubungkan ke Spreadsheet...");
            const [setup, products] = await Promise.all([
                fetch(`${API_URL}/Setup_Toko`).then(r => r.json()),
                fetch(`${API_URL}/Setup_Produk`).then(r => r.json())
            ]);

            clearTimeout(timeout); // Batalkan timeout jika berhasil

            if (setup && setup.length > 0) db_setup = setup[0];
            if (Array.isArray(products)) {
                db_products = products.filter(p => p.Status && p.Status.toLowerCase() === 'aktif');
            }

            renderSetup();
            
            document.getElementById('loader').style.display = 'none';
            console.log("Website siap!");
        } catch (err) {
            clearTimeout(timeout);
            console.error("Error Detail:", err);
            document.getElementById('loader').style.display = 'none';
            alert("Gagal memuat data. Pastikan Spreadsheet sudah di-Publish ke Web!");
        }
    }

    function renderSetup() {
        const shopName = document.getElementById('shopName');
        const slogan = document.getElementById('shopSlogan');
        const logo = document.getElementById('shopLogo');
        const hours = document.getElementById('shopHours');
        const runText = document.getElementById('runningText');

        if (shopName) shopName.innerText = db_setup.Nama_Toko || "Nama Toko Belum Diisi";
        if (slogan) slogan.innerText = db_setup.Slogan || "Slogan Belum Diisi";
        if (logo) logo.src = db_setup.Logo_URL || "https://via.placeholder.com/150";
        if (hours) hours.innerText = db_setup.Jam_Operasional || "24 Jam";
        if (runText) runText.innerText = db_setup.Running_Text || "Selamat datang di toko kami!";
        document.title = db_setup.Nama_Toko || "Online Shop";
    }

    function openCategory(catName) {
        if (catName === 'PREMIUM') {
            showModal(
                '<i class="fas fa-exclamation-circle text-5xl text-yellow-400"></i>',
                'PENTING!',
                'Ini adalah pembelian akun. Akun akan dikirim admin via WhatsApp setelah bayar.',
                'Ya, Saya Mengerti',
                () => { closeModal(); renderSub(catName); }
            );
        } else {
            renderSub(catName);
        }
    }

    function renderSub(catName) {
        activeSub = catName;
        const subList = categories[catName];
        const grid = document.getElementById('subGrid');
        if (!grid) return;
        
        grid.innerHTML = '';
        document.getElementById('subTitle').innerText = catName === 'PULSA' ? 'Pilih Provider' : 'Pilih Item';

        subList.forEach(name => {
            const sample = db_products.find(p => p.Subkategori === name);
            const img = sample ? sample.Image_URL : 'https://via.placeholder.com/150';
            
            grid.innerHTML += `
                <div onclick="openProductDetail('${name}')" class="category-card glass rounded-xl p-2 text-center animate-zoom">
                    <img src="${img}" class="w-full aspect-square object-cover rounded-lg mb-2 shadow-sm">
                    <p class="text-[9px] font-bold uppercase truncate">${name}</p>
                </div>
            `;
        });

        document.getElementById('mainMenu').style.display = 'none';
        document.getElementById('subSection').style.display = 'block';
    }

    function openProductDetail(subName) {
        const products = db_products.filter(p => p.Subkategori === subName);
        const grid = document.getElementById('productGrid');
        if (!grid) return;
        
        grid.innerHTML = '';

        if (products.length > 0) {
            document.getElementById('detailBanner').src = products[0].Image_URL;
            document.getElementById('btnBackText').innerText = subName;
        }

        products.forEach(p => {
            const label = p.Label === 'Terlaris' ? '<span class="absolute top-0 right-0 bg-red-600 text-[7px] px-2 py-1 rounded-bl-lg font-bold shadow-sm">HOT</span>' : '';
            grid.innerHTML += `
                <div onclick="selectNominal('${p.Nama_Produk}', '${p.Harga}', this)" class="product-item glass p-3 rounded-xl relative overflow-hidden transition-all">
                    ${label}
                    <p class="text-[11px] font-bold mb-1">${p.Nama_Produk}</p>
                    <p class="text-[9px] text-gray-500 line-through">Rp ${p.Harga_Coret}</p>
                    <p class="text-xs font-black text-cyan-400">Rp ${p.Harga}</p>
                </div>
            `;
        });

        document.getElementById('subSection').style.display = 'none';
        document.getElementById('productSection').style.display = 'block';
    }

    function selectNominal(name, price, el) {
        document.querySelectorAll('.product-item').forEach(i => i.classList.remove('selected', 'border-cyan-400', 'bg-cyan-400/10'));
        el.classList.add('selected', 'border-cyan-400', 'bg-cyan-400/10');
        selectedProduct = { name, price };
        document.getElementById('totalPrice').innerText = `Rp ${price}`;
        document.getElementById('orderBar').style.display = 'block';
    }

    function submitOrder() {
        const target = document.getElementById('targetId').value;
        if (!target) {
            alert("Harap masukkan Data Akun / Nomor HP terlebih dahulu!");
            return;
        }

        const text = `Halo ${db_setup.Nama_Toko || 'Admin'},\n\n` +
                     `Saya ingin membeli produk berikut:\n` +
                     `ðŸ”¹ *Produk:* ${selectedProduct.name}\n` +
                     `ðŸ”¹ *Data/ID:* ${target}\n` +
                     `ðŸ”¹ *Total Harga:* Rp ${selectedProduct.price}\n\n` +
                     `Mohon segera diproses ya. Terima kasih!`;
        
        const url = `https://wa.me/${db_setup.No_WhatsApp}?text=${encodeURIComponent(text)}`;
        window.open(url, '_blank');
    }

    function backToMain() {
        document.getElementById('subSection').style.display = 'none';
        document.getElementById('mainMenu').style.display = 'grid';
    }

    function backToSub() {
        document.getElementById('productSection').style.display = 'none';
        document.getElementById('orderBar').style.display = 'none';
        document.getElementById('subSection').style.display = 'block';
    }

    function showModal(icon, title, desc, btnText, action) {
        const modal = document.getElementById('modal');
        document.getElementById('modalIcon').innerHTML = icon;
        document.getElementById('modalTitle').innerText = title;
        document.getElementById('modalDesc').innerText = desc;
        const mBtn = document.getElementById('modalBtn');
        mBtn.innerText = btnText;
        mBtn.onclick = action;
        modal.style.display = 'flex';
    }

    function closeModal() {
        document.getElementById('modal').style.display = 'none';
    }

    // Jalankan aplikasi
    init();
</script>
</body>
</html>
